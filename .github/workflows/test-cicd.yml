#name: Github-CI/CD
#
#on:
#  push:
#    branches:
#      - master
#
#jobs:
#  build:
#    runs-on: ubuntu-latest
#
#    steps:
#      - name: 소스 코드 체크아웃
#        uses: actions/checkout@v4
#
#      - name: gradlew 권한 부여
#        run: chmod +x gradlew
#
#      - name: JDK 21 설정
#        uses: actions/setup-java@v4
#        with:
#          java-version: '21'
#          distribution: 'temurin'
#
#      - name: gradlew로 빌드
#        run: ./gradlew clean test bootJar
#
#      - name: Jar 파일 이름 변경
#        run: |
#          mv build/libs/cicd-0.0.1-SNAPSHOT.jar build/libs/cicd-study-1.0.0.jar
#
#      - name: 아티팩트 업로드
#        uses: actions/upload-artifact@v4
#        with:
#          name: cicd-study-application
#          path: build/libs/cicd-study-1.0.0.jar
#
#  deploy:
#    runs-on: ubuntu-latest
#    needs: build
#
#    steps:
#      - name: 아티팩트 다운로드
#        uses: actions/download-artifact@v4
#        with:
#          name: cicd-study-application
#          path: build/libs/
#
#      - name: Deploy to EC2
#        run: |
#          echo "${{ secrets.AWS_SECRET_KEY }}" > private_key.pem
#          chmod 600 private_key.pem
#          scp -i private_key.pem -o StrictHostKeyChecking=no build/libs/cicd-study-1.0.0.jar ${{ secrets.AWS_USER_NAME }}@${{ secrets.AWS_HOST }}:/home/${{ secrets.AWS_USER_NAME }}/cicd-study-1.0.0.jar
#          ssh -i private_key.pem -o StrictHostKeyChecking=no ${{ secrets.AWS_USER_NAME }}@${{ secrets.AWS_HOST }} "pgrep java | xargs kill -9; nohup java -jar /home/${{ secrets.AWS_USER_NAME }}/cicd-study-1.0.0.jar > app.log 2>&1 &"
#          rm -f private_key.pem
